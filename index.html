<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SusanLifeShare • My Picks</title>

  <meta property="og:title" content="SusanLifeShare • My Picks" />
  <meta property="og:description" content="Watch my best clips ✨" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://susanlifeshare.pages.dev/cover.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://susanlifeshare.pages.dev/cover.jpg" />

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#0b0c10; color:#f2f4f8; }
    a { color: inherit; }
    .topbar{ position:sticky; top:0; z-index:50; background:rgba(11,12,16,.85); backdrop-filter:blur(10px); border-bottom:1px solid rgba(255,255,255,.08); }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px; }
    .topbar .wrap{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .brand{ display:flex; flex-direction:column; gap:2px; min-width:190px; }
    .brand h1{ margin:0; font-size:16px; font-weight:900; }
    .brand p{ margin:0; font-size:12px; opacity:.75; }
    .controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
    input, select{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:#f2f4f8;
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      outline:none;
    }
    input::placeholder{ color:rgba(242,244,248,.55); }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:9px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      font-size:12px; font-weight:900;
      text-decoration:none;
      cursor:pointer; white-space:nowrap;
    }
    .btn.ghost{ background:transparent; border-color:rgba(255,255,255,.14); }

    .seg{ display:none; border:1px solid rgba(255,255,255,.12); border-radius:999px; overflow:hidden; }
    .seg.show{ display:flex; }
    .seg button{ border:0; background:transparent; color:#f2f4f8; padding:8px 12px; cursor:pointer; font-weight:900; font-size:13px; opacity:.8; }
    .seg button.active{ background:rgba(125,92,255,.25); opacity:1; }

    .stats{ margin:14px 0 10px; font-size:12px; opacity:.82; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center; }
    .muted{ opacity:.7; }
    .grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
    @media (min-width:860px){ .grid{ grid-template-columns:repeat(4,minmax(0,1fr)); } .brand h1{ font-size:18px; } }
    .card{ display:block; text-decoration:none; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04); border-radius:16px; overflow:hidden; transition:transform .12s ease, border-color .12s ease; }
    .card:hover{ transform:translateY(-2px); border-color:rgba(125,92,255,.55); }
    .thumb{ width:100%; aspect-ratio:9/16; background:rgba(255,255,255,.06); display:block; object-fit:cover; }
    .meta{ padding:10px 10px 12px; }
    .title{ font-size:13px; font-weight:950; line-height:1.25; margin:0 0 8px; }
    .row{ display:flex; gap:8px; align-items:center; justify-content:space-between; }
    .pill{ font-size:11px; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.10); white-space:nowrap; max-width:60%; overflow:hidden; text-overflow:ellipsis; }
    .pill.cat{ background:rgba(125,92,255,.24); }
    .pill.tag{ opacity:.9; }
    .btnline{ display:flex; gap:8px; margin-top:10px; }
    .btnline .btn{ flex:1; }
    .footer{ margin:18px 0 6px; font-size:12px; opacity:.7; text-align:center; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <h1>SusanLifeShare • My Picks</h1>
        <p class="muted">Best clips ✨</p>
      </div>

      <div class="controls">
        <div id="catWrap" class="seg" role="tablist" aria-label="category"></div>
        <input id="q" type="search" placeholder="Search title / tag..." />
        <select id="tag"><option value="all">All tags</option></select>
        <select id="sort">
          <option value="new">Sort: New</option>
          <option value="hot">Sort: Hot</option>
          <option value="az">Sort: A → Z</option>
        </select>

        <!-- ✅ 這顆會觸發 Basic Auth（瀏覽器跳帳密） -->
        <a class="btn ghost" href="/admin/">Login Admin</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="stats">
      <div id="count">Loading…</div>
      <div class="muted">管理新增/刪除/批量移動：請點 Login Admin</div>
    </div>

    <div id="grid" class="grid"></div>

    <div class="footer">© <span id="yy"></span> • susanlifeshare.pages.dev</div>
  </div>

<script>
const DATA_URL = "./data/videos.json";
const DEFAULT_THUMB = "./cover.jpg";

let DB = { categories: [], items: [] };
let state = { cat: "All", q: "", tag: "all", sort: "new" };

const $ = (id) => document.getElementById(id);
const grid = $("grid"), count = $("count"), q = $("q"), tagSel = $("tag"), sortSel = $("sort"), catWrap = $("catWrap");

function escapeHtml(s){ return (s+"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

async function loadData(){
  try{
    const res = await fetch(DATA_URL, { cache:"no-store" });
    const data = await res.json();
    const items = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);
    const categories = Array.isArray(data.categories) ? data.categories : [];
    DB.items = normalize(items);
    DB.categories = categories.map(x => (x||"").trim()).filter(Boolean);
  }catch(e){
    DB.items = [];
    DB.categories = [];
  }
}

function normalize(list){
  return (list||[]).map(x => ({
    title:(x.title||"").trim(),
    url:(x.url||"").trim(),
    thumb:(x.thumb||"").trim(),
    cat:(x.cat||"").trim(),
    tag:(x.tag||"").trim(),
    hot: Number.isFinite(+x.hot) ? +x.hot : 0,
    date:(x.date||"").toString().trim()
  })).filter(x => x.title && x.url);
}

function hasAnyCategory(){
  return (DB.categories && DB.categories.length>0) || DB.items.some(x => (x.cat||"").trim().length>0);
}

function getCats(){
  const fromItems = Array.from(new Set(DB.items.map(x => (x.cat||"").trim()).filter(Boolean)));
  const merged = Array.from(new Set([...(DB.categories||[]), ...fromItems])).sort((a,b)=>a.localeCompare(b));
  return merged;
}

function rebuildCatTabs(){
  catWrap.innerHTML = "";
  if(!hasAnyCategory()){
    catWrap.classList.remove("show");
    state.cat = "All";
    return;
  }
  catWrap.classList.add("show");
  const cats = ["All", ...getCats()];
  if(!cats.includes(state.cat)) state.cat = "All";

  cats.forEach(c=>{
    const b = document.createElement("button");
    b.textContent = c;
    b.dataset.cat = c;
    b.className = (c===state.cat) ? "active" : "";
    b.onclick = () => {
      state.cat = c;
      [...catWrap.querySelectorAll("button")].forEach(x=>x.classList.toggle("active", x.dataset.cat===c));
      render();
    };
    catWrap.appendChild(b);
  });
}

function rebuildTags(){
  tagSel.innerHTML = `<option value="all">All tags</option>`;
  const tags = Array.from(new Set(DB.items.map(x=>x.tag).filter(Boolean))).sort((a,b)=>a.localeCompare(b));
  for(const t of tags){
    const opt = document.createElement("option");
    opt.value = t; opt.textContent = t;
    tagSel.appendChild(opt);
  }
  if (![...tagSel.options].some(o=>o.value===state.tag)) state.tag="all";
  tagSel.value = state.tag;
}

function applyFilter(list){
  return list.filter(x=>{
    if(hasAnyCategory() && state.cat!=="All" && (x.cat||"")!==state.cat) return false;
    if(state.tag!=="all" && x.tag!==state.tag) return false;
    if(state.q){
      const hay = `${x.title} ${x.tag||""} ${x.cat||""}`.toLowerCase();
      if(!hay.includes(state.q)) return false;
    }
    return true;
  });
}
function applySort(list){
  const copy=[...list];
  if(state.sort==="hot") copy.sort((a,b)=>(b.hot||0)-(a.hot||0));
  else if(state.sort==="az") copy.sort((a,b)=>(a.title||"").localeCompare(b.title||""));
  else copy.sort((a,b)=> String(b.date||"").localeCompare(String(a.date||"")));
  return copy;
}

function cardHTML(x){
  const thumb = x.thumb ? x.thumb : DEFAULT_THUMB;
  const catText = (x.cat||"").trim();
  const tagText = x.tag ? x.tag : "untagged";
  const leftPill = catText ? `<span class="pill cat">${escapeHtml(catText)}</span>` : `<span class="pill cat">Video</span>`;
  return `
    <div class="card">
      <a href="${escapeHtml(x.url)}" target="_blank" rel="noopener nofollow">
        <img class="thumb" loading="lazy" src="${escapeHtml(thumb)}" alt="">
      </a>
      <div class="meta">
        <p class="title">${escapeHtml(x.title)}</p>
        <div class="row">
          ${leftPill}
          <span class="pill tag">${escapeHtml(tagText)}</span>
        </div>
        <div class="btnline">
          <a class="btn" style="background:rgba(125,92,255,.24);border-color:rgba(125,92,255,.45);" href="${escapeHtml(x.url)}" target="_blank" rel="noopener nofollow">Watch</a>
          <a class="btn" href="${escapeHtml(x.url)}" target="_blank" rel="noopener nofollow">Open</a>
        </div>
      </div>
    </div>
  `;
}

function render(){
  rebuildCatTabs();
  rebuildTags();
  const filtered = applySort(applyFilter(DB.items));
  count.textContent = `${filtered.length} videos`;
  grid.innerHTML = filtered.map(cardHTML).join("");
}

q.oninput = (e)=>{ state.q = e.target.value.trim().toLowerCase(); render(); };
tagSel.onchange = (e)=>{ state.tag = e.target.value; render(); };
sortSel.onchange = (e)=>{ state.sort = e.target.value; render(); };

(async function init(){
  $("yy").textContent = new Date().getFullYear();
  await loadData();
  render();
})();
</script>
</body>
</html>
